<!DOCTYPE html>
<html>
  <head>
    <title>Module 1</title>
    <style>
      .my-button {
        padding: 10px 15px;
        cursor: pointer;
        background-color: blue;
        color: white;
        border: none;
        border-radius: 5px;
        margin-top: 15px;
      }
      .modal-trigger-button {
        /* Estilo para el nuevo botón */
        padding: 8px 12px;
        cursor: pointer;
        background-color: green;
        color: white;
        border: none;
        border-radius: 5px;
        margin-left: 10px;
      }
    </style>
  </head>
  <body>
    <section id="section1" class="slide-section section-cover" data-function="handleSection1">
      <h2>LLAMADAS<br />PELIGROSAS:</h2>
      <p>Guía para Evitar las Estafas Telefónicas</p>
      <img src="../multimedia/images/course/skull-icon.svg" alt="Ícono de calavera" class="skull-icon" />
      <img src="../multimedia/images/course/phone-icon.svg" alt="Ícono de teléfono" class="phone-icon" />
    </section>

    <section id="section2" class="slide-section section-intro" data-function="handleSection2">
      <h2 id="title2" class="opacity-0">INTRODUCCIÓN</h2>
      <p class="opacity-0 welcome-text" id="s2p1">¡Bienvenidos al curso "<span class="course-title">Llamadas Peligrosas: Guía para Evitar las Estafas Telefónicas</span>"! En este curso aprenderás:</p>
      <ul class="intro-list opacity-0" id="list-section2">
        <li>
          <img src="multimedia/images/course/tecnicas-estafadores.png" alt="Técnicas utilizadas por los estafadores telefónicos" />
          <span>Las técnicas utilizadas por los estafadores telefónicos.</span>
        </li>
        <li>
          <img src="multimedia/images/course/estrategias-proteccion.png" alt="Estrategias para proteger tu información y tu dinero" />
          <span>Las estrategias para proteger tu información y tu dinero.</span>
        </li>
        <li>
          <img src="multimedia/images/course/senales-alerta.png" alt="Señales de alerta a las que tienes que poner atención" />
          <span>Las señales de alerta a las que tienes que poner atención.</span>
        </li>
        <li>
          <img src="multimedia/images/course/ser-victima.png" alt="Qué hacer en caso de ser víctima de una estafa" />
          <span>Y qué hacer en caso de ser víctima de una estafa.</span>
        </li>
      </ul>
      <p class="opacity-0 intro-final" id="s2p2">Asimismo, revisaremos ejemplos de <span class="casos-reales">casos reales</span> para que estés preparado para enfrentar cualquier estafa telefónica.</p>
    </section>

    <section id="section3" class="slide-section" data-function="handleSection3" data-title="Tercera Sección">
      <video class="media-element video-centered">
        <source type="video/mp4" />
      </video>
    </section>

    <section id="section4" class="slide-section section-scam-types" data-function="handleSection4">
      <h2>TIPOS DE ESTAFA</h2>
      <p>En el mundo de las estafas telefónicas, existen diversas tácticas para engañar a las víctimas.</p>
      <p class="instruction-text">DA CLICK EN CADA BOTÓN PARA CONOCER MÁS.</p>
      <div class="carousel-container">
        <div class="carousel">
          <div class="carousel-item">
            <img src="multimedia/images/course/el-pedido-fantasma.png" alt="El Pedido Fantasma" />
            <div class="carousel-item-overlay">
              <button class="more-info-button" data-modal-target="#modal-pedido-fantasma">+</button>
            </div>
            <div class="carousel-item-title">
              <h3>EL PEDIDO FANTASMA</h3>
            </div>
          </div>
          <div class="carousel-item">
            <img src="multimedia/images/course/superheroe-bancario.png" alt="Superhéroe Bancario" />
            <div class="carousel-item-overlay">
              <button class="more-info-button" data-modal-target="#modal-superheroe-bancario">+</button>
            </div>
            <div class="carousel-item-title">
              <h3>SUPERHÉROE BANCARIO</h3>
            </div>
          </div>
          <div class="carousel-item">
            <img src="multimedia/images/course/eres-el-ganador.png" alt="¡Eres el Ganador!" />
            <div class="carousel-item-overlay">
              <button class="more-info-button" data-modal-target="#modal-eres-ganador">+</button>
            </div>
            <div class="carousel-item-title">
              <h3>¡ERES EL GANADOR!</h3>
            </div>
          </div>
          <div class="carousel-item">
            <img src="multimedia/images/course/eres-el-ganador.png" alt="¡Eres el Ganador!" />
            <div class="carousel-item-overlay">
              <button class="more-info-button" data-modal-target="#modal-eres-ganador2">+</button>
            </div>
            <div class="carousel-item-title">
              <h3>¡ERES EL GANADOR!</h3>
            </div>
          </div>
          <div class="carousel-item">
            <img src="multimedia/images/course/eres-el-ganador.png" alt="¡Eres el Ganador!" />
            <div class="carousel-item-overlay">
              <button class="more-info-button" data-modal-target="#modal-eres-ganador3">+</button>
            </div>
            <div class="carousel-item-title">
              <h3>¡ERES EL GANADOR!</h3>
            </div>
          </div>
        </div>
        <div class="carousel-navigation">
          <button class="carousel-nav-button prev" aria-label="Anterior">&#10094;</button>
          <button class="carousel-nav-button next" aria-label="Siguiente">&#10095;</button>
        </div>
      </div>
    </section>

    <section id="section5" class="slide-section section-danger" data-function="handleSection5">
      <div class="text-content">
        <h2>Simulación 01</h2>
        <p>Estás recibiendo una llamada telefónica. Da clic en el teléfono para contestar.</p>
      </div>
      <div class="phone-screen">
        <img src="multimedia/images/course/mano-telefono-svg.svg" alt="Teléfono mostrando mensaje de Cuenta en Peligro" />
        <button class="answer-button">&#x2713;</button>
      </div>
    </section>

    <!-- Modales con audio -->
    <div class="modal-overlay">
      <div id="modal-pedido-fantasma" class="modal-content">
        <button class="modal-close-btn">&times;</button>
        <div class="modal-content-container">
          <div class="modal-header">
            <h4 class="modal-title">TIPOS DE ESTAFA</h4>
            <h2 class="modal-subtitle">EL PEDIDO FANTASMA</h2>
          </div>
          <p class="modal-text">Te llaman diciendo que tienes un pedido por internet pendiente de entrega y te piden detalles de tu tarjeta de crédito para completar la transacción.</p>
        </div>
        <div class="modal-image-container">
          <img src="multimedia/images/course/el-pedido-fantasma-full.png" alt="El Pedido Fantasma" class="modal-image" />
        </div>
      </div>
    </div>

    <div class="modal-overlay">
      <div id="modal-superheroe-bancario" class="modal-content">
        <button class="modal-close-btn">&times;</button>
        <div class="modal-content-container">
          <div class="modal-header">
            <h4 class="modal-title">TIPOS DE ESTAFA</h4>
            <h2 class="modal-subtitle">SUPERHÉROE BANCARIO</h2>
          </div>
          <p class="modal-text">Te llaman haciéndose pasar por un empleado del banco para obtener información confidencial, alegando que tu cuenta está en peligro y necesitan verificar tus datos para protegerla.</p>
        </div>
        <div class="modal-image-container">
          <img src="multimedia/images/course/superheroe-bancario-full.png" alt="Superhéroe Bancario" class="modal-image" />
        </div>
      </div>
    </div>

    <div class="modal-overlay">
      <div id="modal-eres-ganador" class="modal-content">
        <button class="modal-close-btn">&times;</button>
        <div class="modal-content-container">
          <div class="modal-header">
            <h4 class="modal-title">TIPOS DE ESTAFA</h4>
            <h2 class="modal-subtitle">¡ERES EL GANADOR!</h2>
          </div>
          <p class="modal-text">Te contactan para informarte que has ganado un premio o sorteo en el que nunca participaste. Para reclamarlo, te piden datos personales o un pago por adelantado para cubrir "gastos administrativos".</p>
        </div>
        <div class="modal-image-container">
          <img src="multimedia/images/course/eres-el-ganador-full.png" alt="¡Eres el Ganador!" class="modal-image" />
        </div>
      </div>
    </div>
    <div class="modal-overlay">
      <div id="modal-eres-ganador2" class="modal-content">
        <button class="modal-close-btn">&times;</button>
        <div class="modal-content-container">
          <div class="modal-header">
            <h4 class="modal-title">TIPOS DE ESTAFA</h4>
            <h2 class="modal-subtitle">¡ERES EL GANADOR!</h2>
          </div>
          <p class="modal-text">Te contactan para informarte que has ganado un premio o sorteo en el que nunca participaste. Para reclamarlo, te piden datos personales o un pago por adelantado para cubrir "gastos administrativos".</p>
        </div>
        <div class="modal-image-container">
          <img src="multimedia/images/course/eres-el-ganador-full.png" alt="¡Eres el Ganador!" class="modal-image" />
        </div>
      </div>
    </div>
    <div class="modal-overlay">
      <div id="modal-eres-ganador3" class="modal-content">
        <button class="modal-close-btn">&times;</button>
        <div class="modal-content-container">
          <div class="modal-header">
            <h4 class="modal-title">TIPOS DE ESTAFA</h4>
            <h2 class="modal-subtitle">¡ERES EL GANADOR!</h2>
          </div>
          <p class="modal-text">Te contactan para informarte que has ganado un premio o sorteo en el que nunca participaste. Para reclamarlo, te piden datos personales o un pago por adelantado para cubrir "gastos administrativos".</p>
        </div>
        <div class="modal-image-container">
          <img src="multimedia/images/course/eres-el-ganador-full.png" alt="¡Eres el Ganador!" class="modal-image" />
        </div>
      </div>
    </div>

    <script>
      /**
       * Maneja la sección 1 - Portada del curso
       * Configura el audio y los eventos para marcar como completada la sección
       * @param {HTMLElement} section - Elemento de la sección
       */
      window.handleSection1 = function handleSection1(section) {
        const audioSrc = "multimedia/audio/global/60_seg_silencio.mp3";
        const sectionId = section && section.id ? section.id : "section1";
        const events = [
          {
            time: 2,
            actions: [{ type: "sectionCompleted", sectionId }, { type: "nextSection" }],
          },
        ];
        const onEndActions = [];
        courseController.sectionController.audioHandler.prepareAudioSync(() => {
          courseController.sectionController.audioHandler.setupAudioWithEvents(audioSrc, events, onEndActions);
        });
      };

      /**
       * Maneja la sección 2 - Introducción al curso
       * Configura audio y eventos para animar la visualización de elementos
       * @param {HTMLElement} section - Elemento de la sección
       */
      window.handleSection2 = function handleSection2(section) {
        console.log("Manejando sección 2");
        console.log("Ejecutando configuración con retardo para sección 2");
        const audioSrc = "multimedia/audio/06_intro_interactividad_3.mp3";
        const sectionId = section && section.id ? section.id : "section2";
        const events = [
          {
            time: 3,
            actions: [{ type: "removeClass", targetId: "title2", classes: ["opacity-0"] }],
          },
          {
            time: 5,
            actions: [{ type: "removeClass", targetId: "s2p1", classes: ["opacity-0"] }],
          },
          {
            time: 6,
            actions: [
              { type: "removeClass", targetId: "list-section2", classes: ["opacity-0"] },
              { type: "removeClass", targetId: "s2p2", classes: ["opacity-0"] },
            ],
          },
        ];
        const onEndActions = [
          { type: "sectionCompleted", sectionId },
          { type: "nextSection", delay: 2000 },
        ];
        courseController.sectionController.audioHandler.prepareAudioSync(() => {
          courseController.sectionController.audioHandler.setupAudioWithEvents(audioSrc, events, onEndActions);
        });
      };

      /**
       * Maneja la sección 3 - Reproducción de video
       * Configura un video como fuente de medio y acciones para cuando termine
       * @param {HTMLElement} section - Elemento de la sección
       */
      window.handleSection3 = function handleSection3(section) {
        console.log("Manejando sección 3 - Sección de video");
        const videoSrc = "https://spa.tclcdn.com/assets/assets_20200528154013/f238c141.mp4";

        courseController.sectionController.audioHandler.setupVideo(videoSrc, section);

        const slideAudioData = {
          events: [],
          onEndActions: [
            { type: "sectionCompleted", sectionId: section.id },
            { type: "nextSection", delay: 1000 },
          ],
        };

        courseController.sectionController.audioHandler.prepareAudioSync(() => {
          courseController.slideAudioManager.init(slideAudioData);
        });
      };

      /**
       * Maneja la sección 4 - Tipos de estafa con carrusel interactivo
       * Configura listeners para botones modales y carrusel
       * @param {HTMLElement} section - Elemento de la sección
       */
      window.handleSection4 = function handleSection4(section) {
        console.log("Manejando sección 4 - Tipos de Estafa");
        const modalTriggers = section.querySelectorAll("[data-modal-target]");
        const modalIds = Array.from(modalTriggers).map((trigger) => trigger.dataset.modalTarget.replace("#", ""));

        console.log(`Encontrados ${modalIds.length} modales para la sección:`, modalIds);

        // Configurar los modales para esta sección con acciones de completado
        courseController.sectionController.configureSectionModals(section.id, modalIds, [
          {
            type: "sectionCompleted",
            sectionId: section.id,
          },
          {
            type: "nextSection",
            delay: 1000,
          },
        ]);

        // Configurar listeners para botones modales si no se han configurado antes
        modalTriggers.forEach((trigger) => {
          if (!trigger.hasAttribute("data-listener-added")) {
            trigger.addEventListener("click", function (event) {
              event.preventDefault();

              const modalId = this.dataset.modalTarget.replace("#", "");
              if (courseController.modalManager) {
                courseController.modalManager.openModal(modalId);
              } else {
                console.warn("ModalManager no disponible");
              }
            });
            trigger.setAttribute("data-listener-added", "true");
          }
        });

        // Inicializar carrusel
        initializeCarousel(section.querySelector(".carousel"));

        // Configurar audio para esta sección
        const audioSrc = "multimedia/audio/06_intro_interactividad_3.mp3";
        if (audioSrc) {
          courseController.audioController.setAudioSource(audioSrc);
        } else {
          if (courseController.slideAudioManager) {
            courseController.slideAudioManager.stop();
          }
        }
      };

      /**
       * Maneja la sección 5 - Simulación de llamada de estafa
       * Configura el botón de respuesta para avanzar a la siguiente sección
       * @param {HTMLElement} section - Elemento de la sección
       */
      window.handleSection5 = function handleSection5(section) {
        console.log("Manejando sección 5 - Cuenta en Peligro");
        const audioSrc = "multimedia/audio/global/60_seg_silencio.mp3";
        const sectionId = section && section.id ? section.id : "section5";
        const events = [];
        const onEndActions = [];
        courseController.sectionController.audioHandler.prepareAudioSync(() => {
          courseController.sectionController.audioHandler.setupAudioWithEvents(audioSrc, events, onEndActions);
        });
        const answerButton = section.querySelector(".answer-button");
        if (!answerButton) return;
        answerButton.addEventListener("click", () => {
          console.log("Botón de respuesta clicado - Marcando sección como completada y navegando a la siguiente sección.");
          courseController.sectionController.markSectionAsCompleted(section.id);
          courseController.nextPage();
        });
      };

      /**
       * Inicializa el carrusel con navegación
       * @param {HTMLElement} carouselElement - Elemento contenedor del carrusel
       */
      function initializeCarousel(carouselElement) {
        if (!carouselElement) return;

        const items = carouselElement.querySelectorAll(".carousel-item");
        if (items.length === 0) return;

        const prevBtn = document.querySelector(".carousel-nav-button.prev");
        const nextBtn = document.querySelector(".carousel-nav-button.next");

        if (!prevBtn || !nextBtn) return;

        let scrollAmount = 0;
        const scrollStep = 300;

        // Configurar botón anterior
        prevBtn.addEventListener("click", () => {
          scrollAmount = Math.max(0, scrollAmount - scrollStep);
          carouselElement.scrollTo({
            left: scrollAmount,
            behavior: "smooth",
          });
          updateButtonStates();
        });

        // Configurar botón siguiente
        nextBtn.addEventListener("click", () => {
          scrollAmount = Math.min(carouselElement.scrollWidth - carouselElement.clientWidth, scrollAmount + scrollStep);
          carouselElement.scrollTo({
            left: scrollAmount,
            behavior: "smooth",
          });
          updateButtonStates();
        });

        /**
         * Actualiza el estado visual de los botones de navegación
         * basado en la posición actual del scroll
         */
        function updateButtonStates() {
          // Deshabilitar botón anterior si estamos al inicio
          prevBtn.style.opacity = scrollAmount <= 10 ? "0.5" : "1";
          prevBtn.disabled = scrollAmount <= 10;

          // Deshabilitar botón siguiente si estamos al final
          const maxScroll = carouselElement.scrollWidth - carouselElement.clientWidth - 10;
          nextBtn.style.opacity = scrollAmount >= maxScroll ? "0.5" : "1";
          nextBtn.disabled = scrollAmount >= maxScroll;
        }

        // Inicializar estado de botones
        updateButtonStates();

        // Actualizar estado de botones al hacer scroll manualmente
        carouselElement.addEventListener("scroll", () => {
          scrollAmount = carouselElement.scrollLeft;
          updateButtonStates();
        });

        // Actualizar estado de botones al cambiar tamaño de ventana
        window.addEventListener("resize", updateButtonStates);
      }
    </script>
  </body>
</html>
